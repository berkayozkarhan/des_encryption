PROJECT_ROOT_DIR 	= ..
CURRENT_DIR 		= $(shell pwd)
PROJECT_BUILD_DIR = $(PROJECT_ROOT_DIR)/build


DES_MODULE_NAME = des
DES_MODULE_SOURCE_DIR	= $(CURRENT_DIR)/$(DES_MODULE_NAME)
DES_INCLUDE_DIR 		= $(CURRENT_DIR)/$(DES_MODULE_NAME)/include

DES_MODULE_OBJ_DIR 			= $(PROJECT_BUILD_DIR)/$(DES_MODULE_NAME)/obj
DES_OUTPUT_DIR 			= $(PROJECT_BUILD_DIR)/des/lib

DES_DIRECTORIES := $(DES_MODULE_OBJ_DIR) $(DES_OUTPUT_DIR)


SRCS := $(wildcard $(DES_MODULE_SOURCE_DIR)/*.c)
OBJS := $(patsubst $(DES_MODULE_SOURCE_DIR)/%.c, $(DES_MODULE_OBJ_DIR)/%.o, $(SRCS))


TARGET = $(DES_OUTPUT_DIR)/$(DES_MODULE_NAME).so

CC = /usr/bin/gcc
COMPILER_FLAGS = -fPIC --shared 
INCLUDE_FLAGS = -I$(DES_INCLUDE_DIR)


all: prepare $(TARGET)


$(TARGET): $(OBJS)
	$(CC) $(COMPILER_FLAGS) -o $@ $(OBJS)


$(OBJS): $(SRCS)
	$(CC) -c -o $(OBJS) $(INCLUDE_FLAGS) $(SRCS)


prepare:
	mkdir -p $(DES_DIRECTORIES)

clean:
	rm -rf $(PROJECT_BUILD_DIR)/$(DES_MODULE_NAME)
	

